<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scraper Platform</title>
  <link rel="stylesheet" href="popup.css">
  <style>
    /* Tab Navigation */
    .tab-nav {
      display: flex;
      background: #f5f5f5;
      border-bottom: 2px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .tab-button {
      flex: 1;
      padding: 12px 16px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }
    
    .tab-button:hover {
      background: #e8e8e8;
      color: #333;
    }
    
    .tab-button.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
      background: white;
    }
    
    .tab-content {
      display: none;
      padding: 16px;
      max-height: 500px;
      overflow-y: auto;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Library Styles */
    .scraper-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .scraper-item {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 12px;
      transition: all 0.2s;
    }
    
    .scraper-item:hover {
      border-color: #2563eb;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
    }
    
    .scraper-item h4 {
      margin: 0 0 4px 0;
      font-size: 14px;
      color: #333;
    }
    
    .scraper-item p {
      margin: 0;
      font-size: 12px;
      color: #666;
    }
    
    .scraper-actions {
      display: flex;
      gap: 6px;
      margin-top: 10px;
    }
    
    .scraper-actions button {
      flex: 1;
      padding: 6px;
      font-size: 11px;
    }
    
    /* Test Styles */
    .test-results {
      background: #1e1e1e;
      border-radius: 6px;
      padding: 12px;
      margin-top: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .test-results pre {
      margin: 0;
      color: #d4d4d4;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 10px;
      line-height: 1.4;
    }
    
    .import-section {
      margin-bottom: 16px;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 6px;
    }
    
    .import-section textarea {
      width: 100%;
      min-height: 120px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 10px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <!-- Tab Navigation -->
  <div class="tab-nav">
    <button class="tab-button" data-tab="builder">üõ†Ô∏è Build</button>
    <button class="tab-button active" data-tab="library">üìö Library</button>
    <button class="tab-button" data-tab="test">üß™ Test</button>
  </div>

  <!-- Builder Tab (Original) -->
  <div id="tab-builder" class="tab-content">
    <p style="text-align: center; color: #666; padding: 40px 20px;">
      <strong>üõ†Ô∏è Scraper Builder</strong><br><br>
      The original scraper builder is still here!<br>
      Switch to this tab to create new scrapers<br>
      by clicking elements on the page.
    </p>
  </div>

  <!-- Library Tab -->
  <!-- Library Tab -->
  <div id="tab-library" class="tab-content active">
    <h3 style="margin-top: 0; font-size: 16px;">üìö Scraper Library</h3>
    
    <div class="import-section">
      <h4 style="margin-top: 0; font-size: 13px;">üì• Import Scraper JSON</h4>
      <textarea id="import-json" placeholder='{"name": "My Scraper", ...}'></textarea>
      <button class="btn-primary" id="import-json-btn" style="width: 100%; margin-top: 8px; font-size: 12px;">
        Import JSON
      </button>
    </div>
    
    <div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <h4 style="margin: 0; font-size: 13px;">Your Scrapers</h4>
        <button class="btn-secondary" id="refresh-list" style="font-size: 10px; padding: 4px 8px;">üîÑ Refresh</button>
      </div>
      <div id="scraper-list" class="scraper-list">
        <p style="text-align: center; color: #999; padding: 20px; font-size: 12px;">No scrapers yet</p>
      </div>
    </div>
  </div>

  <!-- Test Tab -->
  <div id="tab-test" class="tab-content">
    <h3 style="margin-top: 0; font-size: 16px;">üß™ Test Scraper</h3>
    
    <div class="form-group">
      <label style="font-size: 12px; margin-bottom: 6px;">Select Scraper</label>
      <select id="test-scraper-select" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
        <option value="">Choose a scraper...</option>
      </select>
    </div>
    
    <div id="selected-scraper-info" style="display: none; margin: 12px 0; padding: 10px; background: #f0f7ff; border-left: 3px solid #2563eb; border-radius: 4px; font-size: 11px;">
      <strong id="test-scraper-name" style="display: block; margin-bottom: 4px;"></strong>
      <span id="test-scraper-details" style="color: #666;"></span>
    </div>
    
    <button class="btn-primary" id="run-test-btn" style="width: 100%; font-size: 13px;" disabled>
      ‚ñ∂Ô∏è Run Test on Current Page
    </button>
    
    <div id="test-output" style="display: none;">
      <h4 style="margin: 16px 0 8px 0; font-size: 13px;">Test Results</h4>
      <div class="test-results">
        <pre id="test-results-content"></pre>
      </div>
      
      <button class="btn-secondary" id="copy-results-btn" style="width: 100%; margin-top: 8px; font-size: 12px;">
        üìã Copy Results
      </button>
    </div>
  </div>

  <script src="popup-library.js"></script>
</body>
</html>
      <div class="form-group">
        <label>Jurisdiction Name *</label>
        <input type="text" id="jurisdiction" placeholder="e.g., City of Boston / State of California">
      </div>
      <div class="form-group">
        <label>State Code *</label>
        <select id="state-code">
          <option value="">Select state...</option>
          <option value="AL">AL - Alabama</option>
          <option value="AK">AK - Alaska</option>
          <option value="AZ">AZ - Arizona</option>
          <option value="AR">AR - Arkansas</option>
          <option value="CA">CA - California</option>
          <option value="CO">CO - Colorado</option>
          <option value="CT">CT - Connecticut</option>
          <option value="DE">DE - Delaware</option>
          <option value="FL">FL - Florida</option>
          <option value="GA">GA - Georgia</option>
          <option value="HI">HI - Hawaii</option>
          <option value="ID">ID - Idaho</option>
          <option value="IL">IL - Illinois</option>
          <option value="IN">IN - Indiana</option>
          <option value="IA">IA - Iowa</option>
          <option value="KS">KS - Kansas</option>
          <option value="KY">KY - Kentucky</option>
          <option value="LA">LA - Louisiana</option>
          <option value="ME">ME - Maine</option>
          <option value="MD">MD - Maryland</option>
          <option value="MA">MA - Massachusetts</option>
          <option value="MI">MI - Michigan</option>
          <option value="MN">MN - Minnesota</option>
          <option value="MS">MS - Mississippi</option>
          <option value="MO">MO - Missouri</option>
          <option value="MT">MT - Montana</option>
          <option value="NE">NE - Nebraska</option>
          <option value="NV">NV - Nevada</option>
          <option value="NH">NH - New Hampshire</option>
          <option value="NJ">NJ - New Jersey</option>
          <option value="NM">NM - New Mexico</option>
          <option value="NY">NY - New York</option>
          <option value="NC">NC - North Carolina</option>
          <option value="ND">ND - North Dakota</option>
          <option value="OH">OH - Ohio</option>
          <option value="OK">OK - Oklahoma</option>
          <option value="OR">OR - Oregon</option>
          <option value="PA">PA - Pennsylvania</option>
          <option value="RI">RI - Rhode Island</option>
          <option value="SC">SC - South Carolina</option>
          <option value="SD">SD - South Dakota</option>
          <option value="TN">TN - Tennessee</option>
          <option value="TX">TX - Texas</option>
          <option value="UT">UT - Utah</option>
          <option value="VT">VT - Vermont</option>
          <option value="VA">VA - Virginia</option>
          <option value="WA">WA - Washington</option>
          <option value="WV">WV - West Virginia</option>
          <option value="WI">WI - Wisconsin</option>
          <option value="WY">WY - Wyoming</option>
          <option value="DC">DC - District of Columbia</option>
        </select>
      </div>
      <div class="form-group">
        <label>Level *</label>
        <div class="radio-group">
          <label><input type="radio" name="level" value="state"> State</label>
          <label><input type="radio" name="level" value="local"> Local</label>
          <label><input type="radio" name="level" value="federal"> Federal</label>
        </div>
      </div>
      <div class="form-group">
        <label>Calendar URL *</label>
        <div class="input-with-button">
          <input type="text" id="calendar-url" placeholder="https://example.gov/calendar">
          <button type="button" id="autofill-url" class="btn-secondary">üìç Current URL</button>
        </div>
      </div>
      <div class="form-group">
        <label>Base URL *</label>
        <div class="input-with-button">
          <input type="text" id="base-url" placeholder="https://example.gov">
          <button type="button" id="autofill-base-url" class="btn-secondary">üîó Auto-detect</button>
        </div>
      </div>
      <div class="form-group">
        <label>Requires Puppeteer (Browser Automation)?</label>
        <div class="radio-group">
          <label><input type="radio" name="puppeteer" value="yes"> Yes - Calendar is JavaScript-rendered</label>
          <label><input type="radio" name="puppeteer" value="no" checked> No - Static HTML works</label>
          <label><input type="radio" name="puppeteer" value="unknown"> I don't know</label>
        </div>
        <button type="button" id="auto-detect-puppeteer" class="btn-secondary" style="margin-top: 8px;">üîç Auto-Detect</button>
        <div id="puppeteer-result" class="info-text" style="margin-top: 8px;"></div>
      </div>
      <div class="form-group">
        <label>Notes (optional)</label>
        <textarea id="notes" rows="3" placeholder="Any special considerations..."></textarea>
      </div>
      <button class="btn-primary" id="next-to-calendar">Next: Calendar Structure ‚Üí</button>
    </div>

    <!-- Step 2: Calendar Structure -->
    <div id="step-calendar" class="step">
      <h2>üìÖ Step 2: Calendar Structure</h2>
      
      <div class="capture-helper" style="display: none;" id="capture-helper">
        <strong>üéØ Multi-Step Capture Active!</strong>
        <ul>
          <li>Click an element on the page to capture it</li>
          <li>Click the same button again to add more steps</li>
          <li>Great for: modals, nested content, multi-click interactions</li>
          <li>Press <kbd>ESC</kbd> to finish capturing</li>
        </ul>
      </div>
      
      <p class="instruction">Click buttons below, then click elements on the page. You can capture multiple steps per field (e.g., click popup ‚Üí click element inside).</p>
      
      <div class="field-capture">
        <h3>Navigation (Optional)</h3>
        <button class="capture-btn" data-field="month-view-button">
          <span class="status">‚≠ï</span> Month View Button
        </button>
        <button class="capture-btn" data-field="next-button">
          <span class="status">‚≠ï</span> Next Month Button
        </button>
        <button class="capture-btn" data-field="prev-button">
          <span class="status">‚≠ï</span> Previous Month Button
        </button>
      </div>

      <div class="field-capture">
        <h3>Event List (Optional)</h3>
        <div class="form-group">
          <label>
            <input type="checkbox" id="has-event-list" checked>
            Page has a visible event list (uncheck if calendar only shows via Puppeteer)
          </label>
        </div>
        <div id="event-list-fields" style="margin-top: 12px;">
          <button class="capture-btn" data-field="event-container">
            <span class="status">‚≠ï</span> Event List Container
          </button>
          <button class="capture-btn" data-field="event-item">
            <span class="status">‚≠ï</span> Single Event Item
          </button>
          <div id="events-count" class="info-text"></div>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn-secondary" id="back-to-metadata">‚Üê Back</button>
        <button class="btn-primary" id="next-to-fields">Next: Event Fields ‚Üí</button>
      </div>
    </div>

    <!-- Step 3: Event Fields -->
    <div id="step-fields" class="step">
      <h2>üìù Step 3: Event Fields</h2>
      
      <div class="capture-helper" style="display: none;" id="capture-helper-fields">
        <strong>üéØ Multi-Step Capture Active!</strong>
        <ul>
          <li>Click an element on the page to capture it</li>
          <li>Click the same button again to add more steps</li>
          <li>Great for: modals, nested content, multi-click interactions</li>
          <li>Press <kbd>ESC</kbd> to finish capturing</li>
        </ul>
      </div>
      
      <p class="instruction">Click buttons below, then click elements on the page. Click buttons multiple times for multi-step captures (e.g., click to open details ‚Üí click field).</p>
      
      <div class="field-capture">
        <h3>Required Fields</h3>
        <button class="capture-btn required" data-field="name">
          <span class="status">‚≠ï</span> Event Name
        </button>
        <button class="capture-btn required" data-field="date">
          <span class="status">‚≠ï</span> Date
        </button>
      </div>

      <div class="field-capture">
        <h3>Recommended Fields</h3>
        <button class="capture-btn" data-field="time">
          <span class="status">‚≠ï</span> Time
        </button>
        <button class="capture-btn" data-field="location">
          <span class="status">‚≠ï</span> Location
        </button>
        <button class="capture-btn" data-field="committee">
          <span class="status">‚≠ï</span> Committee
        </button>
        <button class="capture-btn" data-field="details-link">
          <span class="status">‚≠ï</span> Details Link
        </button>
      </div>

      <div class="field-capture">
        <h3>Optional Fields</h3>
        <button class="capture-btn" data-field="description">
          <span class="status">‚≠ï</span> Description
        </button>
        <button class="capture-btn" data-field="type">
          <span class="status">‚≠ï</span> Event Type
        </button>
        <button class="capture-btn" data-field="virtual-link">
          <span class="status">‚≠ï</span> Virtual Meeting Link
        </button>
      </div>

      <div class="btn-group">
        <button class="btn-secondary" id="back-to-calendar">‚Üê Back</button>
        <button class="btn-primary" id="next-to-details">Next: Details Page ‚Üí</button>
        <button class="btn-secondary" id="skip-details">Skip Details Page</button>
      </div>
    </div>

    <!-- Step 4: Details Page -->
    <div id="step-details" class="step">
      <h2>üîç Step 4: Details Page (Optional)</h2>
      <p class="instruction">Navigate to a details page and capture additional fields.</p>
      
      <div class="form-group">
        <label>
          <input type="checkbox" id="has-details-page">
          This site has separate detail pages
        </label>
      </div>

      <div id="details-fields" style="display: none;">
        <div class="field-capture">
          <h3>Details Page Fields</h3>
          <button class="capture-btn" data-field="agenda-url">
            <span class="status">‚≠ï</span> Agenda/PDF Link
          </button>
          <button class="capture-btn" data-field="docket-url">
            <span class="status">‚≠ï</span> Docket Link
          </button>
          <button class="capture-btn" data-field="details-virtual-link">
            <span class="status">‚≠ï</span> Virtual Meeting Link
          </button>
          <button class="capture-btn" data-field="details-description">
            <span class="status">‚≠ï</span> Full Description
          </button>
        </div>

        <div class="field-capture">
          <h3>Bills/Agenda Items</h3>
          <button class="capture-btn" data-field="bills-container">
            <span class="status">‚≠ï</span> Bill List Container
          </button>
          <button class="capture-btn" data-field="bill-item">
            <span class="status">‚≠ï</span> Single Bill Item
          </button>
          <div id="bills-count" class="info-text"></div>
        </div>

        <div class="field-capture">
          <h3>Bill Fields (within a bill item)</h3>
          <button class="capture-btn" data-field="bill-number">
            <span class="status">‚≠ï</span> Bill Number
          </button>
          <button class="capture-btn" data-field="bill-title">
            <span class="status">‚≠ï</span> Bill Title
          </button>
          <button class="capture-btn" data-field="bill-url">
            <span class="status">‚≠ï</span> Bill Link
          </button>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn-secondary" id="back-to-fields">‚Üê Back</button>
        <button class="btn-primary" id="next-to-review">Next: Review ‚Üí</button>
      </div>
    </div>

    <!-- Step 5: Review & Export -->
    <div id="step-review" class="step">
      <h2>‚úÖ Step 5: Review & Export</h2>
      
      <div id="review-summary" class="review-section">
        <h3>Summary</h3>
        <div id="summary-content"></div>
      </div>

      <div class="review-section">
        <h3>Validation</h3>
        <div id="validation-results"></div>
      </div>

      <div class="review-section">
        <h3>Captured Data Preview</h3>
        <pre id="json-preview"></pre>
      </div>

      <div class="btn-group">
        <button class="btn-secondary" id="back-to-details">‚Üê Back</button>
        <button class="btn-primary" id="export-json">üíæ Export JSON</button>
        <button class="btn-secondary" id="copy-json">üìã Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
